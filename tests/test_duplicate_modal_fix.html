<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡å¤æ¨¡æ€æ¡†ä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
        }
        
        .test-title {
            color: #8B4513;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .test-event-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .test-event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(139, 69, 19, 0.2);
        }
        
        .test-calendar-card {
            background: white;
            border-radius: 8px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            margin-bottom: 10px;
        }
        
        .console-output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        
        .clear-btn {
            background: #FFD700;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            color: #8B4513;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
        }
        
        .clear-btn:hover {
            background: #FFA500;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>é‡å¤æ¨¡æ€æ¡†ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•åˆ—è¡¨è§†å›¾æ´»åŠ¨å¡ç‰‡ï¼ˆåŒ…å«å›¾ç‰‡ï¼‰</div>
            <div class="test-event-card event-section" data-event-id="test1">
                <div class="event-info-header">
                    <div class="event-date-title">
                        <div class="event-date">2025-08-02 (åœŸ)</div>
                        <div class="event-title">æµ‹è¯•æ´»åŠ¨æ ‡é¢˜</div>
                    </div>
                    <div class="event-details">
                        <div class="event-venue">ä¼šå ´: ãƒ†ã‚¹ãƒˆä¼šå ´</div>
                        <div class="event-time">é–‹æ¼”17:30 é–‹æ¼”18:30 çµ‚æ¼”20:00</div>
                    </div>
                </div>
                <div class="event-content">
                    <div class="event-image">
                        <img src="image/randpic_å°æ—¥å‘ç¾é¦™_16.jpg" alt="æ´»åŠ¨å›¾ç‰‡" class="group-photo">
                    </div>
                </div>
            </div>
            <p style="font-size: 12px; color: #666;">ç‚¹å‡»ä¸Šé¢çš„æ´»åŠ¨å¡ç‰‡ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼‰åº”è¯¥åªæ˜¾ç¤ºä¸€ä¸ªæ´»åŠ¨è¯¦æƒ…æ¨¡æ€æ¡†</p>
        </div>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•æ—¥å†è§†å›¾æ´»åŠ¨å¡ç‰‡ï¼ˆåŒ…å«å›¾ç‰‡ï¼‰</div>
            <div class="test-calendar-card calendar-event-card" data-event-id="test2">
                <div class="event-info-header">
                    <div class="event-date-title">
                        <div class="event-title">æ—¥å†è§†å›¾æµ‹è¯•æ´»åŠ¨</div>
                    </div>
                </div>
                <div class="event-content">
                    <div class="event-image">
                        <img src="image/randpic_å°æ—¥å‘ç¾é¦™_16.jpg" alt="æ´»åŠ¨å›¾ç‰‡" class="group-photo">
                    </div>
                </div>
            </div>
            <p style="font-size: 12px; color: #666;">ç‚¹å‡»ä¸Šé¢çš„æ—¥å†æ´»åŠ¨å¡ç‰‡ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼‰åº”è¯¥åªæ˜¾ç¤ºä¸€ä¸ªæ´»åŠ¨è¯¦æƒ…æ¨¡æ€æ¡†</p>
        </div>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•ç‹¬ç«‹å›¾ç‰‡</div>
            <img src="image/randpic_å°æ—¥å‘ç¾é¦™_16.jpg" alt="ç‹¬ç«‹å›¾ç‰‡" style="width: 200px; height: auto; border-radius: 10px; cursor: pointer;">
            <p style="font-size: 12px; color: #666;">ç‚¹å‡»ä¸Šé¢çš„ç‹¬ç«‹å›¾ç‰‡åº”è¯¥æ˜¾ç¤ºå›¾ç‰‡æ¨¡æ€æ¡†</p>
        </div>
        
        <div class="test-section">
            <div class="test-title">æ§åˆ¶å°è¾“å‡º</div>
            <button class="clear-btn" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
            <div class="console-output" id="console-output">
                <div>æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
            </div>
        </div>
    </div>

    <script src="i18n.js"></script>
    <script src="config.js"></script>
    <script src="components.js"></script>
    <script src="app.js"></script>
    
    <script>
        // é‡å†™console.logæ¥æ•è·è¾“å‡º
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function logToConsole(message, type = 'log') {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff0000' : type === 'warn' ? '#ff8800' : '#000000';
            console.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToConsole(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            logToConsole(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToConsole(args.join(' '), 'error');
        };
        
        // åˆ›å»ºæµ‹è¯•æ•°æ®
        const testEvents = [
            {
                id: 'test1',
                title: 'ãƒ†ã‚¹ãƒˆæ´»å‹•ã‚¿ã‚¤ãƒˆãƒ«',
                dateRange: '8.02',
                day: 'Sat.',
                year: 2025,
                location: 'ãƒ†ã‚¹ãƒˆä¼šå ´',
                openTime: '17:30',
                time: '18:30',
                endTime: '20:00',
                description: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆæ´»å‹•ã®èª¬æ˜ã§ã™',
                image: 'image/randpic_å°æ—¥å‘ç¾é¦™_16.jpg',
                category: 'other',
                tags: ['ãƒ†ã‚¹ãƒˆ']
            },
            {
                id: 'test2',
                title: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºãƒ†ã‚¹ãƒˆæ´»å‹•',
                dateRange: '8.02',
                day: 'Sat.',
                year: 2025,
                location: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¼šå ´',
                openTime: '17:30',
                time: '18:30',
                endTime: '20:30',
                description: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã®ãƒ†ã‚¹ãƒˆæ´»å‹•ã§ã™',
                image: 'image/randpic_å°æ—¥å‘ç¾é¦™_16.jpg',
                category: 'performance',
                tags: ['ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼', 'ãƒ†ã‚¹ãƒˆ']
            }
        ];
        
        // åˆ›å»ºæµ‹è¯•åº”ç”¨å®ä¾‹
        let testApp = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // åˆ›å»ºæµ‹è¯•æ•°æ®ç®¡ç†å™¨
            const testDataManager = {
                getEvents: () => testEvents,
                getCategories: () => [
                    { id: 'other', name: 'å…¶ä»–æ´»åŠ¨', icon: 'ğŸ ' },
                    { id: 'performance', name: 'æ¼”å‡º', icon: 'ğŸ­' }
                ]
            };
            
            // åˆ›å»ºæµ‹è¯•åº”ç”¨
            testApp = {
                dataManager: testDataManager,
                showEventDetails: function(eventSection) {
                    const eventId = eventSection.dataset.eventId;
                    const event = testEvents.find(e => e.id === eventId);
                    
                    console.log('æ˜¾ç¤ºæ´»åŠ¨è¯¦æƒ…:', eventId, event);
                    
                    if (!event) {
                        console.warn('æœªæ‰¾åˆ°æ´»åŠ¨:', eventId);
                        return;
                    }
                    
                    // æ ¼å¼åŒ–å®Œæ•´æ—¥æœŸï¼ˆåŒ…å«å¹´ä»½ï¼‰
                    const formattedDate = this.formatFullDate(event.dateRange, event.year);
                    
                    // æ ¼å¼åŒ–æ—¶é—´ä¿¡æ¯
                    const timeInfo = this.formatTimeInfo(event);
                    
                    // æ„å»ºæ´»åŠ¨å›¾ç‰‡HTML
                    const imageHtml = event.image ? `
                        <div class="event-modal-image">
                            <img src="${event.image}" alt="${event.title}" class="modal-event-image">
                        </div>
                    ` : '';
                    
                    const content = `
                        ${imageHtml}
                        <div class="event-modal-details">
                            <div class="event-detail-item">
                                <span class="detail-icon">ğŸ“…</span>
                                <span class="detail-label">${languageManager.t('date')}:</span>
                                <span class="detail-value">${formattedDate}</span>
                            </div>
                            <div class="event-detail-item">
                                <span class="detail-icon">ğŸ•</span>
                                <span class="detail-label">${languageManager.t('time')}:</span>
                                <span class="detail-value">${timeInfo}</span>
                            </div>
                            <div class="event-detail-item">
                                <span class="detail-icon">ğŸ“</span>
                                <span class="detail-label">${languageManager.t('venue')}:</span>
                                <span class="detail-value">${event.location || languageManager.t('undetermined')}</span>
                            </div>
                            ${event.description ? `
                            <div class="event-detail-item">
                                <span class="detail-icon">ğŸ“</span>
                                <span class="detail-label">${languageManager.t('description')}:</span>
                                <span class="detail-value">${event.description}</span>
                            </div>
                            ` : ''}
                            ${event.tags && event.tags.length > 0 ? `
                            <div class="event-detail-item">
                                <span class="detail-icon">ğŸ·ï¸</span>
                                <span class="detail-label">${languageManager.t('tags')}:</span>
                                <div class="event-tags-modal">
                                    ${event.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    const modal = new ModalComponent(content, event.title);
                    modal.mount(document.body);
                },
                
                // æ ¼å¼åŒ–å®Œæ•´æ—¥æœŸ
                formatFullDate: function(dateRange, year) {
                    const match = dateRange.match(/^(\d+)\.(\d+)/);
                    if (match) {
                        const month = match[1].padStart(2, '0');
                        const day = match[2].padStart(2, '0');
                        const eventYear = year || new Date().getFullYear();
                        return `${eventYear}-${month}-${day}`;
                    }
                    return dateRange;
                },
                
                // æ ¼å¼åŒ–æ—¶é—´ä¿¡æ¯
                formatTimeInfo: function(event) {
                    const parts = [];
                    
                    if (event.openTime) {
                        parts.push(`${languageManager.t('openTime')} ${event.openTime}`);
                    }
                    if (event.time) {
                        parts.push(`${languageManager.t('startTime')} ${event.time}`);
                    }
                    if (event.endTime) {
                        parts.push(`${languageManager.t('endTime')} ${event.endTime}`);
                    }
                    
                    if (parts.length === 0) {
                        return languageManager.t('undetermined');
                    }
                    
                    return parts.join(' ');
                },
                
                // æ˜¾ç¤ºå›¾ç‰‡æ¨¡æ€æ¡†
                showImageModal: function(src, alt) {
                    const content = `<img src="${src}" alt="${alt}" style="width: 100%; height: auto; border-radius: 10px;">`;
                    const modal = new ModalComponent(content);
                    modal.mount(document.body);
                }
            };
            
            // ç»‘å®šäº‹ä»¶
            document.addEventListener('click', (e) => {
                const eventSection = e.target.closest('.event-section');
                const calendarEventCard = e.target.closest('.calendar-event-card');
                
                // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»çš„æ˜¯æ´»åŠ¨å¡ç‰‡å†…çš„å›¾ç‰‡
                const isImageInEventCard = e.target.closest('img') && 
                    (eventSection || calendarEventCard);
                
                // é˜²æ­¢é‡å¤è§¦å‘
                if (e.defaultPrevented) return;
                
                if (eventSection) {
                    console.log('ç‚¹å‡»åˆ—è¡¨è§†å›¾æ´»åŠ¨å¡ç‰‡:', eventSection.dataset.eventId);
                    testApp.showEventDetails(eventSection);
                } else if (calendarEventCard) {
                    console.log('ç‚¹å‡»æ—¥å†è§†å›¾æ´»åŠ¨å¡ç‰‡:', calendarEventCard.dataset.eventId);
                    testApp.showEventDetails(calendarEventCard);
                } else if (!isImageInEventCard) {
                    // åªæœ‰åœ¨ä¸æ˜¯æ´»åŠ¨å¡ç‰‡å†…çš„å›¾ç‰‡æ—¶æ‰æ˜¾ç¤ºå›¾ç‰‡æ¨¡æ€æ¡†
                    const image = e.target.closest('img');
                    if (image) {
                        console.log('ç‚¹å‡»ç‹¬ç«‹å›¾ç‰‡:', image.src);
                        e.stopPropagation();
                        testApp.showImageModal(image.src, image.alt);
                    }
                }
            });
            
            console.log('æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '<div>æ§åˆ¶å°å·²æ¸…ç©º...</div>';
        }
    </script>
</body>
</html> 